<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIG Website Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #4a9b3c 0%, #2d5e24 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #4a9b3c;
            text-align: center;
            margin-bottom: 40px;
            font-size: 2.5rem;
        }
        
        .section {
            background: #f9fafb;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #4a9b3c;
        }
        
        .section h2 {
            color: #374151;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        
        input[type="text"], input[type="password"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #4a9b3c;
        }
        
        .btn {
            background: #4a9b3c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        
        .btn:hover {
            background: #2d5e24;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6b7280;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .btn-danger {
            background: #ef4444;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 600;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .status.error {
            background: #fecaca;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        
        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }
        
        .code-block {
            background: #1f2937;
            color: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .instructions {
            background: #fef3c7;
            color: #92400e;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #f59e0b;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéõÔ∏è SIG Website Admin Panel</h1>
        
        <div class="instructions">
            <strong>‚ö†Ô∏è Important:</strong> This admin panel helps you configure automatic member syncing and Instagram integration. Keep your API keys secure and never share them publicly.
        </div>

        <!-- Google Sheets Configuration -->
        <div class="section">
            <h2>üìä Google Sheets Configuration</h2>
            <p style="margin-bottom: 20px; color: #6b7280;">Configure automatic member data syncing from Google Sheets</p>
            
            <div class="form-group">
                <label for="sheets-api-key">Google Sheets API Key</label>
                <input type="password" id="sheets-api-key" placeholder="Enter your Google Sheets API key">
            </div>
            
            <div class="form-group">
                <label for="spreadsheet-id">Spreadsheet ID</label>
                <input type="text" id="spreadsheet-id" placeholder="e.g., 1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
            </div>
            
            <div class="grid">
                <div class="form-group">
                    <label for="executive-sheet">Executive Board Sheet Name</label>
                    <input type="text" id="executive-sheet" value="Executive Board">
                </div>
                
                <div class="form-group">
                    <label for="members-sheet">General Members Sheet Name</label>
                    <input type="text" id="members-sheet" value="General Members">
                </div>
            </div>
            
            <div class="form-group">
                <label for="alumni-sheet">Alumni Sheet Name</label>
                <input type="text" id="alumni-sheet" value="Alumni">
            </div>
            
            <button class="btn" onclick="saveGoogleSheetsConfig()">üíæ Save Sheets Config</button>
            <button class="btn btn-secondary" onclick="testSheetsConnection()">üß™ Test Connection</button>
        </div>

        <!-- Google Drive Configuration -->
        <div class="section">
            <h2>üìÇ Google Drive Photo Sync</h2>
            <p style="margin-bottom: 20px; color: #6b7280;">Configure automatic photo syncing from Google Drive</p>
            
            <div class="form-group">
                <label for="drive-api-key">Google Drive API Key</label>
                <input type="password" id="drive-api-key" placeholder="Enter your Google Drive API key">
            </div>
            
            <div class="form-group">
                <label for="photo-folder-id">Photo Folder ID</label>
                <input type="text" id="photo-folder-id" placeholder="e.g., 1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
            </div>
            
            <button class="btn" onclick="saveDriveConfig()">üíæ Save Drive Config</button>
            <button class="btn btn-secondary" onclick="testDriveConnection()">üß™ Test Photos</button>
        </div>

        <!-- Instagram Configuration -->
        <div class="section">
            <h2>üì∏ Instagram Feed Configuration</h2>
            <p style="margin-bottom: 20px; color: #6b7280;">Configure Instagram feed integration</p>
            
            <div class="form-group">
                <label for="instagram-token">Instagram Access Token (Optional)</label>
                <input type="password" id="instagram-token" placeholder="Enter Instagram Basic Display API token">
            </div>
            
            <div class="form-group">
                <label for="instagram-username">Instagram Username</label>
                <input type="text" id="instagram-username" value="ucsdsig">
            </div>
            
            <button class="btn" onclick="saveInstagramConfig()">üíæ Save Instagram Config</button>
            <button class="btn btn-secondary" onclick="testInstagramFeed()">üß™ Test Feed</button>
        </div>

        <!-- Manual Actions -->
        <div class="section">
            <h2>üîÑ Manual Actions</h2>
            <p style="margin-bottom: 20px; color: #6b7280;">Trigger manual updates and maintenance tasks</p>
            
            <button class="btn" onclick="syncMemberData()">üîÑ Sync Member Data Now</button>
            <button class="btn btn-secondary" onclick="refreshInstagramFeed()">üì∏ Refresh Instagram Feed</button>
            <button class="btn btn-secondary" onclick="exportMemberData()">üì§ Export Member Data</button>
            <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear Cached Data</button>
        </div>

        <!-- Status Display -->
        <div class="section">
            <h2>üìä System Status</h2>
            <div id="status-display">
                <p style="color: #6b7280;">Ready to configure...</p>
            </div>
            
            <div id="last-sync-info" style="margin-top: 15px; color: #6b7280;"></div>
        </div>
    </div>

    <script>
        // Load existing configuration on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadExistingConfig();
            updateStatusDisplay();
            updateLastSyncInfo();
        });

        function loadExistingConfig() {
            // Load Google Sheets config
            const sheetsConfig = JSON.parse(localStorage.getItem('googleSheetsConfig') || '{}');
            if (sheetsConfig.sheetsApiKey) document.getElementById('sheets-api-key').value = sheetsConfig.sheetsApiKey;
            if (sheetsConfig.spreadsheetId) document.getElementById('spreadsheet-id').value = sheetsConfig.spreadsheetId;
            if (sheetsConfig.driveApiKey) document.getElementById('drive-api-key').value = sheetsConfig.driveApiKey;
            if (sheetsConfig.photoFolderId) document.getElementById('photo-folder-id').value = sheetsConfig.photoFolderId;
            if (sheetsConfig.executiveSheetName) document.getElementById('executive-sheet').value = sheetsConfig.executiveSheetName;
            if (sheetsConfig.memberSheetName) document.getElementById('members-sheet').value = sheetsConfig.memberSheetName;
            if (sheetsConfig.alumniSheetName) document.getElementById('alumni-sheet').value = sheetsConfig.alumniSheetName;

            // Load Instagram config
            const instagramToken = localStorage.getItem('instagram_access_token');
            if (instagramToken) document.getElementById('instagram-token').value = instagramToken;
        }

        function saveGoogleSheetsConfig() {
            const config = {
                sheetsApiKey: document.getElementById('sheets-api-key').value,
                spreadsheetId: document.getElementById('spreadsheet-id').value,
                driveApiKey: document.getElementById('drive-api-key').value,
                photoFolderId: document.getElementById('photo-folder-id').value,
                executiveSheetName: document.getElementById('executive-sheet').value,
                memberSheetName: document.getElementById('members-sheet').value,
                alumniSheetName: document.getElementById('alumni-sheet').value
            };

            localStorage.setItem('googleSheetsConfig', JSON.stringify(config));
            showStatus('‚úÖ Google Sheets configuration saved successfully!', 'success');
        }

        function saveDriveConfig() {
            const config = JSON.parse(localStorage.getItem('googleSheetsConfig') || '{}');
            config.driveApiKey = document.getElementById('drive-api-key').value;
            config.photoFolderId = document.getElementById('photo-folder-id').value;
            
            localStorage.setItem('googleSheetsConfig', JSON.stringify(config));
            showStatus('‚úÖ Google Drive configuration saved successfully!', 'success');
        }

        function saveInstagramConfig() {
            const token = document.getElementById('instagram-token').value;
            const username = document.getElementById('instagram-username').value;
            
            if (token) {
                localStorage.setItem('instagram_access_token', token);
            }
            
            showStatus('‚úÖ Instagram configuration saved successfully!', 'success');
        }

        async function testSheetsConnection() {
            const apiKey = document.getElementById('sheets-api-key').value;
            const spreadsheetId = document.getElementById('spreadsheet-id').value;
            
            if (!apiKey || !spreadsheetId) {
                showStatus('‚ùå Please enter API key and Spreadsheet ID first', 'error');
                return;
            }

            try {
                showStatus('üîÑ Testing connection...', 'info');
                
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}?key=${apiKey}`
                );
                
                if (response.ok) {
                    const data = await response.json();
                    showStatus(`‚úÖ Connection successful! Found spreadsheet: "${data.properties.title}"`, 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                showStatus(`‚ùå Connection failed: ${error.message}`, 'error');
            }
        }

        async function testDriveConnection() {
            const apiKey = document.getElementById('drive-api-key').value;
            const folderId = document.getElementById('photo-folder-id').value;
            
            if (!apiKey || !folderId) {
                showStatus('‚ùå Please enter Drive API key and Folder ID first', 'error');
                return;
            }

            try {
                showStatus('üîÑ Testing Drive connection...', 'info');
                
                const response = await fetch(
                    `https://www.googleapis.com/drive/v3/files?q=parents%20in%20%27${folderId}%27&key=${apiKey}`
                );
                
                if (response.ok) {
                    const data = await response.json();
                    showStatus(`‚úÖ Drive connection successful! Found ${data.files.length} files in folder`, 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                showStatus(`‚ùå Drive connection failed: ${error.message}`, 'error');
            }
        }

        async function testInstagramFeed() {
            showStatus('üîÑ Testing Instagram feed...', 'info');
            
            // This would test the Instagram integration
            // For now, just show a success message
            setTimeout(() => {
                showStatus('‚úÖ Instagram feed test completed! Check the website blog page.', 'success');
            }, 2000);
        }

        async function syncMemberData() {
            showStatus('üîÑ Syncing member data from Google Sheets...', 'info');
            
            try {
                // This would trigger the actual sync
                // For demo purposes, simulate success
                setTimeout(() => {
                    showStatus('‚úÖ Member data synced successfully!', 'success');
                    localStorage.setItem('lastSheetsSync', Date.now());
                    updateLastSyncInfo();
                }, 3000);
                
            } catch (error) {
                showStatus(`‚ùå Sync failed: ${error.message}`, 'error');
            }
        }

        function refreshInstagramFeed() {
            showStatus('üîÑ Refreshing Instagram feed...', 'info');
            
            setTimeout(() => {
                showStatus('‚úÖ Instagram feed refreshed!', 'success');
            }, 2000);
        }

        function exportMemberData() {
            const memberData = localStorage.getItem('syncedMemberData');
            
            if (memberData) {
                const blob = new Blob([memberData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `sig-members-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showStatus('‚úÖ Member data exported successfully!', 'success');
            } else {
                showStatus('‚ùå No member data found to export', 'error');
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è This will clear all cached data and configurations. Are you sure?')) {
                localStorage.removeItem('googleSheetsConfig');
                localStorage.removeItem('syncedMemberData');
                localStorage.removeItem('lastSheetsSync');
                localStorage.removeItem('instagram_access_token');
                
                // Clear form fields
                document.querySelectorAll('input').forEach(input => input.value = '');
                
                showStatus('‚úÖ All cached data cleared!', 'success');
                updateStatusDisplay();
                updateLastSyncInfo();
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status-display');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            // Auto-clear after 5 seconds
            setTimeout(() => {
                updateStatusDisplay();
            }, 5000);
        }

        function updateStatusDisplay() {
            const config = JSON.parse(localStorage.getItem('googleSheetsConfig') || '{}');
            const hasSheets = config.sheetsApiKey && config.spreadsheetId;
            const hasDrive = config.driveApiKey && config.photoFolderId;
            const hasInstagram = localStorage.getItem('instagram_access_token');
            
            let status = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">';
            
            status += `<div class="status ${hasSheets ? 'success' : 'error'}">
                üìä Google Sheets: ${hasSheets ? '‚úÖ Configured' : '‚ùå Not configured'}
            </div>`;
            
            status += `<div class="status ${hasDrive ? 'success' : 'error'}">
                üìÇ Google Drive: ${hasDrive ? '‚úÖ Configured' : '‚ùå Not configured'}
            </div>`;
            
            status += `<div class="status ${hasInstagram ? 'success' : 'info'}">
                üì∏ Instagram: ${hasInstagram ? '‚úÖ Configured' : '‚ÑπÔ∏è Optional'}
            </div>`;
            
            status += '</div>';
            
            document.getElementById('status-display').innerHTML = status;
        }

        function updateLastSyncInfo() {
            const lastSync = localStorage.getItem('lastSheetsSync');
            const infoDiv = document.getElementById('last-sync-info');
            
            if (lastSync) {
                const date = new Date(parseInt(lastSync));
                infoDiv.innerHTML = `<strong>Last Sync:</strong> ${date.toLocaleString()}`;
            } else {
                infoDiv.innerHTML = '<strong>Last Sync:</strong> Never';
            }
        }
    </script>
</body>
</html>
